<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Assignment: Homework 2: Fuzzing and Delta Debugging</title>
</head>
<body>
<p>Due: <strong>Monday, Feb 19, 2024, 11:59 PM PT</strong></p>
<p>You may work with others on this assignment but each student must submit his or her own write up, clearly specifying the collaborators. The write ups should be individual, not created jointly, and written in the student’s own words. <strong>Late assignments will not be accepted without prior permission.</strong><br/><br/><span style="font-size: 14pt;"><strong>Overview</strong></span></p>
<p>The goal of this assignment is, given a program <em>P</em> and a small test suite <em>T</em> on which P passes, use Fuzzing to generate more tests and identify a test case <em>T'</em> for which program fails for a particular reason. Next, use an automated technique called delta debugging to reduce <em>T'</em> to a minimal test case which still cause <em>P</em> to fail for the same reason.</p>
<p>The assignment consists of:</p>
<ol style="list-style-type: decimal;">
<li>Installing and using AFL to fuzz the seed input test case provided by the user and generate more tests for a sorting program including the test cases for which the program fails.  </li>
<li>Installing and using delta debugging to reduce a large failing test case generated by AFL that makes a sorting program fail to a small test case. <br/>Delta debugging is a perl script, and the AFL and sorting program is written in C, so you’ll need either a linux/unix-based operating system (MacOS works), or Cygwin for Windows, or a virtual machine running one of those (e.g., <a href="https://it.engineering.oregonstate.edu/citrix" target="_blank">https://it.engineering.oregonstate.edu/citrix</a>).</li>
<li>Answering problem questions about fuzzing, delta debugging and the bug localization process.</li>
</ol>
<p><strong><span style="font-size: 14pt;"><br/>Resources</span></strong></p>
<ul>
<li><span style="font-size: 12pt;">AFLplusplus — <a class="inline_disabled" href="https://github.com/AFLplusplus/AFLplusplus" target="_blank" title="Link">https://github.com/AFLplusplus/AFLplusplus</a> — is an updated version of AFL (American Fuzzy Lop) tool. </span></li>
<li><span style="font-size: 12pt;">Delta debugging — <a href="http://www.st.cs.uni-saarland.de/dd" target="_blank">http://www.st.cs.uni-saarland.de/dd</a> — is a fairly sophisticated program. We will be using a slightly older version, which has fewer features and is easier to use when you are just starting out. You can download this version here: <a class="instructure_file_link inline_disabled" data-api-endpoint="https://canvas.oregonstate.edu/api/v1/courses/1964338/files/102664118" data-api-returntype="File" data-canvas-previewable="false" href="/~motwanim/courses/cs569_winter2024/web_resources/Uploaded Media/delta-2003.7.14.tar.gz" target="_blank" title="delta-2003.7.14.tar.gz">delta-2003.7.14.tar.gz</a></span></li>
<li><span style="font-size: 12pt;">In addition to delta debugging, download the following:</span>
<ul>
<li><span style="font-size: 12pt;">A buggy integer sorting program: <a class="instructure_file_link instructure_scribd_file inline_disabled" data-api-endpoint="https://canvas.oregonstate.edu/api/v1/courses/1964338/files/102664282" data-api-returntype="File" data-canvas-previewable="false" href="/~motwanim/courses/cs569_winter2024/web_resources/Uploaded Media/mysort.c" target="_blank" title="mysort.c">mysort.c</a></span></li>
<li><span style="font-size: 12pt;">A makefile to build the sorting program: <a class="instructure_file_link inline_disabled" data-api-endpoint="https://canvas.oregonstate.edu/api/v1/courses/1964338/files/102664283" data-api-returntype="File" data-canvas-previewable="false" href="/~motwanim/courses/cs569_winter2024/web_resources/Uploaded Media/Makefile" target="_blank" title="Makefile">Makefile</a></span></li>
<li><span style="font-size: 12pt;">An input list of integers, one per line, on which the buggy integer sorting program passes: <a class="instructure_file_link instructure_scribd_file inline_disabled" data-api-endpoint="https://canvas.oregonstate.edu/api/v1/courses/1964338/files/103422922" data-api-returntype="File" data-canvas-previewable="false" href="/~motwanim/courses/cs569_winter2024/web_resources/Uploaded Media/big_test.txt" target="_blank" title="big_test.txt">big_test.txt</a></span></li>
</ul>
</li>
</ul>
<p> </p>
<p><span style="font-size: 12pt;"><strong><span style="font-size: 14pt;">Setup</span></strong></span></p>
<ol style="list-style-type: decimal;">
<li><span style="font-size: 12pt;">Clone the AFLplusplus repository and install it using the instructions described in <a class="inline_disabled" href="https://github.com/AFLplusplus/AFLplusplus/blob/0c054f520eda67b7bb15f95ca58c028e9b68131f/docs/INSTALL.md" target="_blank" title="Link">docs/INSTALL.md</a>. </span><span style="font-size: 12pt;">After successful installation, you should have <em><strong>afl-gcc</strong></em> and <em><strong>afl-fuzz</strong></em> binary files in your cloned AFLplusplus directory. </span></li>
<li><span style="font-size: 12pt;">Install the delta debugging tool by unpacking <span style="font-size: 10pt; font-family: 'courier new', courier;"><strong><span style="color: #236fa1;">delta-2003.7.14.tar.gz</span></strong></span>. We will be using the program <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>delta/bin/delta</strong></span> in the unpacked directory. It is a perl script, so no building is necessary. See <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>delta/README</strong></span> after unpacking the distribution for more information.</span></li>
<li><span style="font-size: 12pt;">Set your default C compiler path to point to AFL gcc compiler that will instrument your program by using command: <em><strong>export CC= &lt;path-to&gt;/AFLplusplus/afl-gcc, </strong></em>where<strong></strong><em><strong> &lt;path-to&gt; </strong></em>is replaced with the absolute path to the cloned AFLplusplus directory. </span></li>
<li><span style="font-size: 12pt;">Execute <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>make</strong></span> and verify that <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>mysort.c</strong></span> compiles. This should produce a binary file <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>mysort</strong></span>. Its usage is:<br/><span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>mysort &lt;input file&gt; &lt;timeout&gt;<br/></strong></span></span>where:
<ul style="list-style-type: square;">
<li><span style="font-size: 12pt;"><span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>&lt;input file&gt; </strong></span></span>is a text file containing a list of integers, one per line, to be sorted, and</li>
<li><span style="font-size: 12pt;"><span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>&lt;timeout&gt; </strong></span></span>is a positive integer denoting the number of seconds the sorting routine should run</li>
</ul>
</li>
</ol>
<p style="padding-left: 40px;">In the case of a timeout, <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>mysort</strong></span><span style="font-size: 12pt; color: var(--ic-brand-font-color-dark); font-family: inherit;"> will print the message:<br/></span><span style="font-size: 12pt;"><span style="color: #236fa1; font-family: 'courier new', courier;"><strong><span style="font-size: 10pt;">Error: timeout<br/></span></strong></span>The timeout is necessary because the sorting routine, being buggy, might loop indefinitely on some inputs. Ensure that <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>&lt;timeout&gt; </strong></span>is reasonably large so that the program times out genuinely due to indefinite looping. The slower your machine, the higher should <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>&lt;timeout&gt; </strong></span>be. Generally, a couple of seconds (2-4 seconds) should suffice for most machines. Setting the timeout too high may mean that AFL and delta debugging takes a long time to reduce the test input. </span></p>
<p>     </p>
<p><span style="font-size: 18pt;"><strong>Problem</strong></span></p>
<p><strong><span style="font-size: 14pt;">Fuzzing</span></strong></p>
<p>To generate tests using AFL for the mysort program, use the following steps.</p>
<ul style="list-style-type: disc;">
<li>Create two directories: <strong><em>input_tests</em></strong> and <em><strong>output_tests</strong> </em> in the same directory where you compiled <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>mysort.c</strong></span> and where <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>mysort</strong></span> binary exists. Place the <span style="font-size: 12pt;"><a class="instructure_file_link instructure_scribd_file inline_disabled" data-api-endpoint="https://canvas.oregonstate.edu/api/v1/courses/1964338/files/103422922" data-api-returntype="File" data-canvas-previewable="false" href="/~motwanim/courses/cs569_winter2024/web_resources/Uploaded Media/big_test.txt" target="_blank" title="big_test.txt">big_test.txt</a></span> file inside the <strong><em>input_tests </em></strong>directory.</li>
<li>Run command <strong><em>&lt;path-to&gt;AFLplusplus/afl-fuzz -D -i input_tests/ -o output_tests/ ./mysort @@ &lt;timeout&gt;  </em></strong>by replacing <strong><em>&lt;path-to&gt;</em></strong> with the absolute path to the AFLplusplus cloned repository and <em><strong>&lt;timeout&gt;</strong></em> with the timeout you use (typically 2-4 seconds). <em>If AFL aborts before starting by displaying the reason and suggestion, then just follow the suggestion and re-run AFL.</em> On successful execution, you should see the following screen. You can refer to <a class="inline_disabled" href="https://github.com/AFLplusplus/AFLplusplus/blob/0c054f520eda67b7bb15f95ca58c028e9b68131f/docs/afl-fuzz_approach.md#understanding-the-status-screen" target="_blank" title="Link">understanding-the-status-screen</a> document to understand what different colors and fields mean. You should stop AFL once it finds test cases that cause the  <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>mysort </strong></span>program to hang (i.e., <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>mysort</strong></span> takes more time to run that the specified timeout). For this, you should see the number of <strong>"saved hangs" </strong>under <strong>"overall results"</strong>. <br/>Once, <strong>"saved hangs" </strong>&gt; 0, stop the AFL by pressing CTRL +  c on your keyboard. <br/><img alt="image.png" data-api-endpoint="https://canvas.oregonstate.edu/api/v1/courses/1964338/files/103423201" data-api-returntype="File" height="618" src="/~motwanim/courses/web_resources/Uploaded Media/image.png" width="630"/></li>
<li>Analyze the test files generated by AFL that make <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>mysort</strong></span><span style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;"> program hang. These files are stored under </span><strong style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;"><em>output_tests/default/hangs</em></strong><span style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;"> directory</span><strong style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;"><em>. </em></strong><span style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;">Rename the generated file to</span><strong style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;"> <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;">big_failing_test.txt</span><em>. </em></strong><span style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;">Also, analyze the files generated by AFL under</span><strong style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;"><em> output_tests/default/queue </em></strong><span style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;"><span style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;">directory </span>to see how other test cases look like.</span><strong style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;"><em> </em></strong><span style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;">Execute the <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>mysort</strong></span></span><span style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;"> binary </span><strong style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;">directly </strong><span style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;">on the identified failing test (</span><span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>big_failing_test.txt</strong></span><span style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;">) by running command:</span><strong style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;"> <em>./<span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>mysort</strong></span> &lt;path to big_failing_test.txt&gt; &lt;timeout&gt;</em></strong><em style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;"> </em><span style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;">and verify that <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>mysort</strong></span></span><span style="color: var(--ic-brand-font-color-dark); font-family: inherit; font-size: 1rem;"> gives you the timeout error. </span><br/><br/></li>
</ul>
<p><strong><span style="font-size: 14pt;">Delta Debugging<br/></span></strong><br/>Now we have identified that the bug in <span style="font-family: 'courier new', courier;"><span style="color: #236fa1; font-size: 10pt;"><strong>mysort.c </strong></span></span>manifests when <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>mysort</strong></span> is run with command line arguments consisting of a reasonably large <span style="font-size: 12pt;"><span style="color: #236fa1; font-family: 'courier new', courier;"><strong><span style="font-size: 10pt;">timeout</span></strong></span></span> and the <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>big_failing_test.txt </strong></span>file generated by AFL: it does not produce a sorted list of integers that is a permutation of the list of integers in the file <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>big_failing_test.txt</strong></span></p>
<p><strong></strong>However, as its name suggests, <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>big_failing_test.txt</strong></span><span style="font-size: 10pt; font-family: 'courier new', courier;"><strong><span style="color: #236fa1;"> </span></strong></span>is not the minimal test case on which <span style="font-family: 'courier new', courier;"><span style="color: #236fa1; font-size: 10pt;"><strong>mysort</strong></span></span> fails. Use the delta debugging tool to obtain a minimal test case on which <span style="font-family: 'courier new', courier;"><span style="color: #236fa1; font-size: 10pt;"><strong>mysort</strong></span></span> fails and, moreover, for the same reason. <em>You will need to write a script</em>, called <span style="font-size: 10pt; font-family: 'courier new', courier;"><strong><span style="color: #236fa1;">script</span></strong></span>, and run the command:</p>
<p><span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>delta/bin/delta -test=script -cp_minimal=min_failing_test.txt &lt; big_failing_test.txt</strong></span></p>
<p>If script is written correctly, the above command will create a minimal test case named <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>min_failing_test.txt</strong></span>. You might want to read the file <span style="font-size: 10pt; font-family: 'courier new', courier;"><strong><span style="color: #236fa1;">delta/doc/using delta.txt</span></strong></span> (except the sections "Topformflat" and "Multidelta" since we are using line granularity and we are running the tool on a single file, <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>big_failing_test.txt</strong></span>, instead of on multiple files).</p>
<p>Note that <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>delta</strong></span> runs the test script in a subdirectory like <span style="font-size: 10pt; font-family: 'courier new', courier;"><strong><span style="color: #236fa1;">tmp0/arena/</span></strong></span>. You may need to take this into account.</p>
<p> </p>
<p><span style="font-size: 18.6667px;"><strong>Deliverables</strong></span></p>
<p>Write the answers to the problem questions in either<span> </span><strong>writeup.txt</strong><span> </span>or<span> </span><strong>writeup.pdf</strong>.<span> </span><strong>Include your name in this file.</strong></p>
<p>Compress the following <strong>four</strong> <strong>files</strong> into a single<span> </span><strong>.zip</strong><span> </span>archive (call it<span> <strong>afl_</strong></span><strong>delta_lastname.zip</strong>) and upload it.</p>
<ul style="list-style-type: square;">
<li><span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>big_failing_test.txt, script</strong></span> and <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>min_failing_test.txt</strong></span> files. We should be able to run the above delta debugging command by placing your submitted files and our own copies of <span style="font-family: 'courier new', courier;"><span style="color: #236fa1; font-size: 10pt;"><strong>mysort</strong></span></span> and <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>big_failing_test.txt</strong></span> in the same directory to produce <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>min_failing_test.txt. </strong></span></li>
<li>Manually step through the sorting function <span style="font-family: 'courier new', courier;"><span style="color: #236fa1; font-size: 10pt;"><strong>sort</strong></span></span> in <span style="font-family: 'courier new', courier;"><span style="color: #236fa1; font-size: 10pt;"><strong>mysort.c</strong></span></span>, simulating its execution on the list of integers in <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>min_failing_test.txt</strong></span>, and answer the following questions in your<span> </span><strong>writeup.txt</strong><span> </span>or<span> </span><strong>writeup.pdf</strong>:
<ol style="list-style-type: decimal;">
<li>Explain the cause of the bug in the source code of the <span style="font-family: 'courier new', courier;"><span style="color: #236fa1; font-size: 10pt;"><strong>sort</strong></span></span> function (that is, the reason why <span style="font-family: 'courier new', courier;"><span style="color: #236fa1; font-size: 10pt;"><strong>mysort</strong></span></span> fails on <span style="color: #236fa1; font-size: 10pt; font-family: 'courier new', courier;"><strong>min_failing_test.txt</strong></span>).</li>
<li>Characterize all input lists on which the sort function will fail because of the reason reported in (1) above.</li>
<li>Report a fix for the bug.</li>
</ol>
</li>
</ul>
<p> </p>
<p><strong><span style="font-size: 14pt;">Solution:</span></strong></p>
<p>Q1. Explain the cause of the bug in the source code of the sort function (that is, the reason why mysort fails on min failing test.txt).</p>
<p>Soln. The cause of the bug is that the nested while loops (inside the sort function) get executed infinitely in case of sorting the duplicate numbers which are in adjacent nodes of the linked list. This happens because the if condition inside the inner while loop "y-&gt;data &gt;= z-&gt;data" is always true for adjacent duplicate numbers and this makes "CHANGED" variable to true and z not null. Thus, the sort function keeps swapping the two adjacent linked list nodes with duplicate numbers and doesn't terminates.  <br/>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p>
<p>Q2. Characterize all input lists on which the sort function will fail because of the reason reported in (1) above.</p>
<p>Soln. The program will fail for any input lists that contains atleast one duplicate number. </p>
<p>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p>
<p>Q3. Report a fix for the bug.</p>
<p>Soln. Inside the sort function, change the if condition (in inner while loop) "y-&gt;data &gt;= z-&gt;data" to "y-&gt;data &gt; z-&gt;data".</p>
</body>
</html>