<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Assignment: Homework 3: Dynamic Race Detection</title>
</head>
<body>
<p>Due: <strong>Monday, Mar 11, 2024, 11:59 PM PT</strong></p>
<p>You may work with others on this assignment but each student must submit his or her own write up, clearly specifying the collaborators. The write ups should be individual, not created jointly, and written in the student’s own words. <strong>Late assignments will not be accepted without prior permission.</strong><br/><br/><span style="font-size: 14pt;"><strong>Overview</strong></span></p>
<p>The goal of this assignment is to learn to use a dynamic race detection tool. This assignment requires you to go a bit beyond what you’ve learned in lecture, and read up on writing multi-threaded programs in Java, what races are, and how to avoid them.</p>
<p>The assignment consists of:</p>
<ol style="list-style-type: decimal;">
<li>Using a dynamic race detection tool called C<span style="font-size: 10pt;">HECK</span>S<span style="font-size: 10pt;">YNC</span>.</li>
<li>Answering problem questions about dynamic race detection.</li>
</ol>
<p> </p>
<p><span style="font-size: 14pt;"><strong>Resources</strong></span></p>
<p><span style="font-size: 12pt;">Download <a class="instructure_file_link inline_disabled" data-api-endpoint="https://canvas.oregonstate.edu/api/v1/courses/1964338/files/102684365" data-api-returntype="File" data-canvas-previewable="false" href="/~motwanim/courses/cs569_winter2024/web_resources/Uploaded Media/datarace-homework.zip" target="_blank" title="datarace-homework.zip">datarace-homework.zip</a> with:</span></p>
<ul style="list-style-type: circle;">
<li><span style="font-size: 12pt;">The Java executable (<strong><span style="color: #236fa1; font-family: 'courier new', courier;">checkSync.jar</span></strong> file) for </span>C<span style="font-size: 10pt;">HECK</span>S<span style="font-size: 10pt;">YNC</span><span style="font-size: 12pt;">, a dynamic race detection tool.</span></li>
<li><span style="font-size: 12pt;">The Java source code (<span style="color: #236fa1; font-family: 'courier new', courier;"><strong>.java</strong></span> files) and executable (<span style="color: #236fa1; font-family: 'courier new', courier;"><strong>.class</strong></span> files) for multi-threaded programs POOL and <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>Harness</strong></span>, on which we will run CHECKSYNC.</span></li>
</ul>
<p><span style="font-size: 12pt;">At the end of this document, there is a section that explains how to interpret </span>C<span style="font-size: 10pt;">HECK</span>S<span style="font-size: 10pt;">YNC o</span>utput. You should find this resource very useful.</p>
<p> </p>
<p><span style="font-size: 12pt;"><span style="font-size: 14pt;"><strong>Setup</strong></span></span></p>
<p>POOL is a generic object-pooling library that may be used by a client program to optimize the usage of resources like sockets and database connections. The library, whose source code is provided to you, consists of class <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>SleepingObjectFactory </strong></span>that implements an object factory, and class <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>GenericObjectPool </strong></span>that uses the object factory to implement an object pool (denoted by the interface <span style="font-family: 'courier new', courier;"><strong><span style="color: #236fa1;">ObjectPool</span></strong></span>). Class <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>GenericObjectPool </strong></span>extends class <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>BaseObjectPool </strong></span>and implements interface <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>ObjectPool</strong></span>.</p>
<p>A client program that uses POOL to manage its resources may call the methods declared in interface <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>ObjectPool</strong></span>. For instance, methods <span style="font-family: 'courier new', courier;"><strong><span style="color: #236fa1;">.borrowObject</span></strong></span> and <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>.returnObject</strong></span> enable borrowing objects from the pool and returning them back, respectively, while the <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>.close</strong></span> method instructs the pool to close and clean up. The <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>ObjectPool </strong></span>interface provides many other methods, but we will focus on just these three methods in this assignment.</p>
<p>The class <span style="font-size: 12pt;"><span style="color: #236fa1; font-family: 'courier new', courier;"><strong>Harness</strong></span></span>, whose source code is also provided to you, tests the implementation of the <span style="font-family: 'courier new', courier;"><strong><span style="color: #236fa1;">.borrowObject</span></strong></span>, <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>.returnObject</strong></span>, and <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>.close</strong></span> methods in Pool. Specifically, it simulates a multi-threaded client program that first constructs a pool, then spawns a bunch of threads that simultaneously and repeatedly invoke the <span style="font-family: 'courier new', courier;"><strong><span style="color: #236fa1;">.borrowObject</span></strong></span> and <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>.returnObject</strong></span> methods on that pool and, finally, when all these threads are done, closes the pool by calling the <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>.close</strong></span> method. We wish to determine if the pool can be corrupted by this multi-threaded client program.  </p>
<p>C<span style="font-size: 10pt;">HECK</span>S<span style="font-size: 10pt;">YNC</span> is a dynamic race detection tool based on the Eraser algorithm. If you are interested, you may read more about Eraser here: <a href="http://dl.acm.org/citation.cfm?id=265927" target="_blank">http://dl.acm.org/citation.cfm?id=265927</a> </p>
<p>C<span style="font-size: 10pt;">HECK</span>S<span style="font-size: 10pt;">YNC</span> takes as input a Java program and produces the file sync.log that reports potential races the tool found in the program. For instance, to run the tool on the above test case, you need to execute the following:</p>
<p><span style="font-family: 'courier new', courier;"><strong><span style="color: #236fa1;">java -cp ./checkSync.jar:. edu.umd.cs.pugh.CheckSync Harness<br/></span></strong></span><strong></strong></p>
<ul>
<li>Note that the .jar is compiled using Java 6 (v1.6). If you use Java 8 (v1.8) or later, the binaries should execute just fine. You should not run into any compatibility problems, since you are not compiling the code, but if you do, the <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>-source 6</strong></span> and<span style="color: #236fa1; font-family: 'courier new', courier;"><strong> -target 6</strong></span> arguments to java may prove useful.</li>
<li>Note that the : separator in the <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>-classpath</strong></span> argument is specific to Linux-based operating systems and that Windows uses ; </li>
</ul>
<p> </p>
<p><strong><span style="font-size: 14pt;">Problems</span></strong></p>
<ol style="list-style-type: decimal;">
<li>Write a small test case <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>RaceFreeTest.java</strong></span> containing a multi-threaded Java program that is race-free but for which the Eraser algorithm, and hence the CheckSync tool, reports a single false race between a pair of accesses (at least one of which is a write, of course).<br/>For a quick tutorial on how to write multithreaded programs in Java, see <a href="http://www.tutorialspoint.com/java/java_multithreading.htm" target="_blank">https://www.tutorialspoint.com/java/java_multithreading.htm</a> and you may find the Harness sample multi-threaded program useful. <br/>
<ol style="list-style-type: upper-alpha;">
<li>Submit <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>RaceFreeTest.java</strong></span></li>
<li>In a separate <strong>writeup.txt</strong> or <strong>writeup.pdf</strong>, cut and paste the generated <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>sync.log </strong></span>(it must contain a single false race) along with a short explanation why you think the false race was reported.<br/><br/></li>
</ol>
</li>
<li>Run C<span style="font-size: 10pt;">HECK</span>S<span style="font-size: 10pt;">YNC </span>on the <span style="font-size: 12pt;"><span style="color: #236fa1; font-family: 'courier new', courier;"><strong>Harness </strong></span></span>test case for the POOL library as described above. Submit the generated <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>sync.log</strong></span> and answer the following two problems in the same <strong>writeup.txt</strong> from above.<br/>
<ol style="list-style-type: upper-alpha;">
<li>For each reported race in <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>sync.log</strong></span>, state whether it is a real race or a false race, along with a short explanation why you think it is real or false. You will need to inspect the stack trace generated for each reported race in <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>sync.log</strong></span> and the sources of the <span style="font-size: 12pt;"><span style="color: #236fa1; font-family: 'courier new', courier;"><strong>Harness </strong></span></span>test case and the POOL library. You may group your answers for similar races together instead of describing each race separately. Be careful: A reported race may seem real when in fact it is false!</li>
<li>For each reported race that is real (as opposed to false), suggest a fix in the POOL library that eliminates it.</li>
</ol>
</li>
</ol>
<p> </p>
<p><span style="font-size: 14pt;"><strong>Deliverables</strong></span></p>
<p>Compress the following three files into a single <strong>.zip</strong> archive (call it <strong>datarace_lastname.zip</strong>) and upload it.</p>
<ol style="list-style-type: decimal;">
<li><span style="color: #236fa1; font-family: 'courier new', courier;"><strong>RaceFreeTest.java</strong></span> from problem 1(A).</li>
<li><strong>writeup.txt</strong> or <strong>writeup.pdf</strong> from problems 1(B), 2(A), and 2(B).</li>
<li><span style="color: #236fa1; font-family: 'courier new', courier;"><strong>sync.log</strong></span> from problem 2.</li>
</ol>
<p> </p>
<p><span style="font-size: 14pt;"><strong>Interpreting C<span style="font-size: 10pt;">HECK</span>S<span style="font-size: 10pt;">YNC</span> output</strong></span></p>
<p><span style="font-size: 14pt;"><strong>C<span style="font-size: 10pt;">HECK</span>S<span style="font-size: 10pt;">YNC</span></strong><span style="font-size: 12pt;"> will write the results of tracing the synchronization in a file <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>sync.log</strong></span>. Here is an example of a possible error:</span></span></p>
<p style="padding-left: 80px;"><span style="font-family: 'courier new', courier;"><strong><span style="font-size: 14pt; color: #236fa1;"><span style="font-size: 12pt;">Possibly broken synchronization on Elevator.myFloor<br/>Previously accessed in Elevator.currentFloor in thread Elevator 0 <br/></span></span></strong></span><span style="font-family: 'courier new', courier;"><strong><span style="font-size: 14pt; color: #236fa1;"><span style="font-size: 12pt;">  with the following locks held: Elevator<br/>current access in thread Elevator 0:<br/>      Elevator.serviceFloor(Elevator.java:108)<br/>      Elevator.lessDumbAlgorithm(Elevator.java:172)<br/>      Elevator.run(Elevator.java:236)<br/>with no locks held</span></span></strong></span></p>
<p>This states that the variable <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>Elevator.myFloor</strong></span> could have been accessed by different threads not holding a common lock. In this case, it points out that the last time the variable <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>Elevator.myFloor</strong></span> was accessed, in method <span style="font-family: 'courier new', courier;"><strong><span style="font-size: 14pt; color: #236fa1;"><span style="font-size: 12pt;">Elevator.currentFloor</span></span></strong></span>, a lock named <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>Elevator </strong></span>was held. The current access, which occurred in the method <span style="font-family: 'courier new', courier;"><strong><span style="font-size: 14pt; color: #236fa1;"><span style="font-size: 12pt;">Elevator.serviceFloor</span></span></strong></span> (with a stack trace showing how this was executed), had no locks held.</p>
<p>To use this tool well, you will probably want to give your threads meaningful names. You can do this by using the constructor <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>Thread(String name)</strong></span>; in the case you are extending <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>Thread</strong></span>, just include <span style="color: #236fa1; font-family: 'courier new', courier;"><strong>super(myname)</strong></span> as the first line of your constructor.</p>
<p> </p>
<p><span style="font-size: 14pt;"><strong>Solution:<br/></strong></span></p>
<p><span style="font-size: 14pt;"><strong><a class="instructure_file_link inline_disabled" data-canvas-previewable="false" href="/~motwanim/courses/cs569_winter2024/web_resources/Uploaded Media/HW3.zip" target="_blank" title="HW3.zip">HW3.zip</a></strong></span></p>
<p> </p>
</body>
</html>